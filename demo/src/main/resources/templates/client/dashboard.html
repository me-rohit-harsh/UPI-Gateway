<!DOCTYPE html>
<html lang='en'>

<head>
    <meta charset='UTF-8'>
    <meta name='viewport' content='width=device-width, initial-scale=1.0'>
    <title>Client Area|| JixWallet</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha2/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://unpkg.com/sleek-dashboard/dist/assets/css/sleek.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/1.10.20/css/dataTables.bootstrap4.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/responsive/2.2.3/css/responsive.bootstrap4.min.css">
    <!-- Bootstrap CSS -->
    <link href='https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css' rel='stylesheet'>
    <!-- Font Awesome CSS -->
    <link href='https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css' rel='stylesheet'>

    <!-- Custome css  -->
    <!-- Custom Styles -->
    <link rel="stylesheet" th:href="@{/css/client/style.css}">
    <style>
        #warning-text {
            display: none;
        }

        /* #fund-submit-button {
            display: block;
        } */
    </style>
</head>

<body>
    <!-- Your HTML content here -->
    <div class='dashboard'>
        <div class="dashboard-nav">
            <header><a href="#!" class="menu-toggle"><i class="fas fa-bars"></i></a>
                <!-- <a href="/profile" class="brand-logo"><i class="fas fa-user"></i> <span>username</span></a> -->
                <!-- <a href="/"><img src="logo2.png" alt="Logo" class="logo"></a> -->
            </header>
            <nav class="dashboard-nav-list">
                <a href="/dashboard" class="dashboard-nav-item active "><i class="fas fa-tachometer-alt"></i> Dashboard
                </a>
                <a href="/profile" class="dashboard-nav-item "><i class="fas fa-user"></i> Profile </a>
                <a href="/credittransaction" class="dashboard-nav-item "><i class="fas fa-file-upload rotate-180"></i>
                    Credit
                    History </a>
                <a href="debittransaction" class="dashboard-nav-item "><i class="fas fa-file-download"></i> Debit
                    History
                </a>
                <a href="refund" class="dashboard-nav-item"><i class="fa-solid fa-list fas"></i> Refund History </a>
                <!-- <div class='dashboard-nav-dropdown'>
                                        <a href="#!" class="dashboard-nav-item dashboard-nav-dropdown-toggle"><i
                                                class="fas fa-money-check-alt"></i> Payment Method </a>
                                        <div class='dashboard-nav-dropdown-menu'>
                                            <a href="#" class="dashboard-nav-dropdown-item">Bank Details</a>
                                            <a href="#" class="dashboard-nav-dropdown-item">UPI Details</a>
                                        </div>
                                    </div> -->
                <a href="/method" class="dashboard-nav-item"><i class="fas fa-money-check-alt"></i> Payment Method </a>
                <a href="/security" class="dashboard-nav-item"><i class="fas fa-solid fa-fingerprint"></i> Security </a>

                <a href="/p2p" class="dashboard-nav-item"><i class="fas fa-cogs"></i> P2P </a>
                <div class="nav-item-divider"></div>
                <a href="/signout" class="dashboard-nav-item"><i class="fas fa-sign-out-alt"></i> Logout </a>
            </nav>
        </div>
        <div class='dashboard-app'>
            <header class="dashboard-toolbar">
                <a href="#!" class="menu-toggle"><i class="fas fa-bars"></i></a>
                <a href="/profile" class="brand-logo" style="margin-right: 15px; display: flex; align-items: center;">
                    <i class="fas fa-user" style="font-size: 1.5em; margin-right: 10px;"></i>
                    <div style="display: flex; flex-direction: column;">
                        <span th:text="${user.username}" style="font-weight: bold;"></span>
                        <span th:text="${#dates.format(user.lastLogin, 'yyyy-MM-dd HH:mm:ss')}"
                            style="font-size: 0.8em; color: gray;"></span>
                    </div>
                </a>

            </header>
            <div class='dashboard-content container'>
                <div class="container text-center mt-4">
                    <!-- Display flash message if available -->
                    <div th:if="${message}" class="alert alert-success" role="alert">
                        <strong th:text="${message}"></strong>

                    </div>
                    <div th:if="${errorMsg}" class="alert alert-danger" role="alert">
                        <strong th:text="${errorMsg}"></strong>
                    </div>
                </div>
                <div class="container  mt-3">

                    <div class="card-content card shadow">
                        <div class='card-header'>
                            <h1>Welcome back
                                <strong th:if="${user.name != null}" th:text="${user.name}">Name</strong>
                                <strong th:if="${user.name == null}" th:text="${user.username}">Username</strong>
                            </h1>

                        </div>
                        <div class="card-body">
                            <div class="col-12">
                                <div class="row">
                                    <div class="col-md-8 col-12">
                                        <p>
                                            <!-- <strong th:text="${session.user}"></strong> -->
                                            <strong>Your Balance:</strong>
                                        </p>
                                        <h1>
                                            ₹ <span th:text="${user.balance}">0.00</span>
                                        </h1>
                                        <p class="mb-0">Adding funds can help reduce the number of small transactions on
                                            your account
                                        </p>
                                    </div>
                                    <div
                                        class="col-md-4 col-12 d-flex align-items-center justify-content-center justify-content-md-end">
                                        <a class="btn-secondary btn mt-2 lnkbtn text-light" id="addFundButton"
                                            data-toggle="modal" data-target="#raiseTicketModal">Deposit
                                            Now<i class="m-2 fa-solid fas ml-2 fa-angle-right"></i>
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <form method="post" th:action="@{/save-utr}" id="add-funds-form">
                    <div class="modal fade" id="raiseTicketModal" tabindex="-1" role="dialog"
                        aria-labelledby="raiseTicketModalLabel" aria-hidden="true">
                        <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable" role="document">
                            <div class="modal-content">
                                <div class="modal-header d-flex justify-content-between align-items-center">
                                    <h5 class="modal-title" id="raiseTicketModalLabel">Add Funds</h5>
                                    <a type="button" class="close" data-dismiss="modal" aria-label="Close"> <span
                                            aria-hidden="true"
                                            style="font-size: 30px !important; padding: 0 10px;">&times;</span>
                                    </a>
                                </div>

                                <div class="modal-body">



                                    <div class="main-content  ">
                                        <p>Add funds to your account with us to avoid lots of small
                                            transactions and to automatically take care of any new invoices
                                            that are generated.</p>
                                        <div class="form-group my-3">
                                            <label for="amount" class="control-label">Amount to Add:</label>
                                            <div class="input-group">
                                                <input type="number" name="amount" id="amount"
                                                    placeholder="Enter an amount" class="form-control" required />
                                            </div>
                                            <div class="buttons-group buttons-5 m-b-2x my-2" id="add-credits-buttons">
                                                <button class="btn btn-lg btn-light" type="button"
                                                    data-price="50">₹50</button>
                                                <button class="btn btn-lg btn-light" type="button"
                                                    data-price="100">₹100</button>
                                                <button class="btn btn-lg btn-light" type="button"
                                                    data-price="250">₹250</button>
                                                <button class="btn btn-lg btn-light" type="button"
                                                    data-price="500">₹500</button>
                                                <button class="btn btn-lg btn-light" type="button"
                                                    data-price="1000">₹1000</button>
                                            </div>
                                        </div>
                                        <div class="form-group my-3">
                                            <label for="paymentmethod" class="control-label">Payment
                                                Method:</label> <select name="method" id="paymentMethod"
                                                class="form-control" required disabled>
                                                <option value="" selected disabled>Select Payment
                                                    Method</option>
                                                <option value="IMPS/NEFT">IMPS/NEFT</option>
                                                <option value="UPI">UPI</option>
                                                <option value="QR Code">QR Code</option>
                                                <option value="USDT (BEP20)">USDT (BEP20)</option>
                                                <option value="USDT (TRC20)">USDT (TRC20)</option>
                                                <option value="USDT (BNB)">USDT (Binance ID)</option>
                                            </select>
                                        </div>
                                        <div class="form-group my-3">
                                            <div id="bankDetails"
                                                style="display: none; border: 1px solid #ccc; padding: 10px; margin-top: 10px;">
                                                <h5>Bank Details</h5>
                                                <p>
                                                    <strong>Bank Name:</strong> Avinash Aryan
                                                </p>
                                                <p>
                                                    <strong>Account Number:</strong> 091252000000996
                                                </p>
                                                <p>
                                                    <strong>IFSC Code:</strong> YESB0001409
                                                </p>
                                            </div>



                                            <div id="phonepayDetails"
                                                style="display: none; border: 1px solid #ccc; padding: 10px; margin-top: 10px;">
                                                <h5>UPI Details</h5>
                                                <p>
                                                    <strong>Bank Name:</strong> Avinash Aryan
                                                </p>
                                                <p>
                                                    <strong>UPI UPI ID:</strong> ambitionyes@ibl
                                                </p>
                                                <a id="UPILink" class="btn btn-primary">Pay with UPI</a>

                                            </div>


                                            <div id="qrCodeDetails" style="display: none; text-align: center;">
                                                <h5 class="mb-0">Amount: <strong id="totalAmount"></strong>/-
                                                </h5>

                                                <div class="text-center" id="qrCodeContainer">

                                                    <!-- Dynamic QR code will be inserted here  -->


                                                </div>


                                            </div>
                                            <div id="usdtBep"
                                                style="display: none; border: 1px solid #ccc; padding: 10px; margin-top: 10px;">
                                                <!-- <h5>USDT (BEP 20)</h5> -->
                                                <div class="text-center">
                                                    <img class="qrCode" th:src="@{/images/bep.jpeg}" alt="BEP QR Code">
                                                </div>
                                                <div class="input-group">
                                                    <input type="text" id="bepInput" readonly
                                                        value="TXYRRuGw89bXjVRM97wsGiNDea6uxgoLMM"
                                                        class="form-control text-center">
                                                    <button onclick="copyToClipboard('bepInput')"
                                                        class="btn btn-outline-secondary" type="button">
                                                        <i class="fa-regular fa-copy"></i>
                                                    </button>
                                                </div>
                                            </div>

                                            <div id="usdtTrc"
                                                style="display: none; border: 1px solid #ccc; padding: 10px; margin-top: 10px;">
                                                <!-- <h5>USDT (TRC 20)</h5> -->
                                                <div class="text-center">
                                                    <img class="qrCode" th:src="@{/images/tron.jpeg}" alt="TRC QR Code">
                                                </div>
                                                <div class="input-group">
                                                    <input type="text" id="trcInput" readonly
                                                        value="0xc3057a93793f52631edbd72d1c0955c114fa1f39"
                                                        class="form-control text-center">
                                                    <button onclick="copyToClipboard('trcInput')"
                                                        class="btn btn-outline-secondary" type="button">
                                                        <i class="fa-regular fa-copy"></i>
                                                    </button>
                                                </div>
                                            </div>

                                            <div id="usdtBnb" style="display: none;  margin-top: 10px;">
                                                <!-- <h5>BNB</h5> -->
                                                <div class="input-group">
                                                    <input type="text" id="bnbInput" readonly value="898464539"
                                                        class="form-control text-center">
                                                    <button onclick="copyToClipboard('bnbInput')"
                                                        class="btn btn-outline-secondary" type="button">
                                                        <i class="fa-regular fa-copy"></i>
                                                    </button>
                                                </div>
                                            </div>

                                        </div>

                                        <script>
                                            function copyToClipboard(inputId) {
                                                var inputElement = document.getElementById(inputId);
                                                inputElement.select();
                                                inputElement.setSelectionRange(0, 99999); // For mobile devices
                                                document.execCommand("copy");
                                                alert("Copied to clipboard: " + inputElement.value);
                                            }
                                        </script>

                                        <script>
                                            document
                                                .getElementById('amount')
                                                .addEventListener(
                                                    'input',
                                                    function () {
                                                        var amountInput = this.value
                                                            .trim();
                                                        var paymentMethodSelect = document
                                                            .getElementById('paymentMethod');

                                                        if (amountInput !== "") {
                                                            paymentMethodSelect
                                                                .removeAttribute('disabled');

                                                        } else {
                                                            paymentMethodSelect
                                                                .setAttribute(
                                                                    'disabled',
                                                                    'disabled');
                                                        }
                                                    });

                                            document
                                                .getElementById('paymentMethod')
                                                .addEventListener(
                                                    'change',
                                                    function () {
                                                        var amountInput = document
                                                            .getElementById('amount').value
                                                            .trim();
                                                        var amountField = document
                                                            .getElementById('amount');
                                                        var creditButton = document
                                                            .getElementById('add-credits-buttons');
                                                        creditButton.style.display = 'none';
                                                        amountField.setAttribute(
                                                            'readonly',
                                                            'readonly');
                                                        if (amountInput === "") {
                                                            alert("Please fill out the amount to proceed.");
                                                            this.selectedIndex = 0; // Reset the select element to the default option
                                                        }
                                                    });
                                        </script>


                                        <div class="form-actions">
                                            <button type="button" value="Submit Order"
                                                class="btn btn-lg btn-block btn-primary" data-btn-loader
                                                onclick="submitOrder()">Submit Order</button>
                                        </div>

                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal fade" id="secondModal" tabindex="-1" role="dialog"
                        aria-labelledby="secondModalLabel" aria-hidden="true">
                        <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable " role="document">
                            <div class="modal-content">
                                <div class="modal-header d-flex justify-content-between align-items-center">
                                    <h5 class="modal-title" id="raiseTicketModalLabel">Submit
                                        Payment Details</h5>
                                    <a type="button" class="close" data-dismiss="modal" aria-label="Close"> <span
                                            aria-hidden="true"
                                            style="font-size: 30px !important; padding: 0 10px;">&times;</span>
                                    </a>
                                </div>
                                <div class="modal-body">
                                    <!-- <p>Provide Payment Details</p> -->
                                    <div class="form-group form-action">



                                        <div class="form-group my-2">
                                            <!-- Input field for the selected payment method -->
                                            <label for="exampleInputEmail1">Payment ID </label> <input type="text"
                                                id="paymentInput" name="refId" class="form-control"
                                                placeholder="Enter UTR/Txn Id/UPI Ref No." required>
                                        </div>

                                        <!-- Attachment button -->

                                        <!-- <div class="form-group my-2">
                				                                <label for="exampleInputEmail1">Payment ScreenShot(Optional) </label>
                				                                <input type="file" class="form-control" name="file" accept="image/*"
                				                                    onchange="checkFileSize(this)">
                				                                <span class="text-danger" id="fileSizeMsg"></span>
                				                            </div> -->
                                        <div class="form-group my-2">

                                            <label for="exampleInputEmail1">Email ID </label> <input type="email"
                                                id="emailId" name="email" class="form-control"
                                                placeholder="You will recieve confirmation mail on the registred email Id"
                                                readonly disabled>
                                        </div>
                                        <!-- Submit button -->
                                        <button type="submit" class="btn btn-primary btn-lg btn-block"
                                            id="fund-submit-button">
                                            <span>Add Fund</span>
                                        </button>
                                        <p class="text-warning mt-3" id="warning-text"> <strong
                                                class="text-danger">Note*</strong> Please
                                            do not close or exit from this window!</p>

                                    </div>
                                </div>

                            </div>
                        </div>
                    </div>


                </form>
                <script>
                    document.getElementById('add-funds-form').addEventListener('submit', function (event) {
                        document.getElementById('fund-submit-button').style.display = 'none';
                        document.getElementById('warning-text').style.display = 'block';
                    });
                </script>
                <div class='container mt-3'>
                    <div class='card p-3 shadow'>
                        <h2>All Transaction History</h2>
                        <hr>
                        <div class='card-body p-0'>
                            <table id="responsive-data-table" class=" container table dt-responsive nowrap"
                                style="width:100%">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Amount</th>
                                        <th>Status</th>
                                        <th>Reference ID</th>
                                        <th>Type</th>
                                        <th>Method</th>
                                        <th>Updated At</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr th:each="transaction : ${transactions}">
                                        <td th:text="${transaction.id}"></td>
                                        <td th:text="${transaction.amount}"></td>
                                        <td><span th:if="${transaction.status}"
                                                style="color: rgb(32, 184, 32);">Successful</span> <span
                                                th:unless="${transaction.status}" style="color: red;">Failed</span>
                                        </td>
                                        <td th:text="${transaction.refId}"></td>
                                        <td th:text="${transaction.type}"></td>
                                        <td th:text="${transaction.method}"></td>
                                        <td th:text="${transaction.updatedAt}"></td>
                                    </tr>
                                </tbody>
                                <tfoot>
                                    <tr>
                                        <th>ID</th>
                                        <th>Amount</th>
                                        <th>Status</th>
                                        <th>Reference ID</th>
                                        <th>Type</th>
                                        <th>Method</th>
                                        <th>Updated At</th>
                                    </tr>
                                </tfoot>
                            </table>




                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <!-- Bootstrap JS (optional) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script src="https://cdn.datatables.net/1.10.20/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.10.20/js/dataTables.bootstrap4.min.js"></script>
    <script src="https://cdn.datatables.net/responsive/2.2.3/js/dataTables.responsive.min.js"></script>
    <script>jQuery(document).ready(function () {
            jQuery('#responsive-data-table').DataTable({
                "pageLength": 10,
                "dom": '<"row justify-content-between top-information"lf>rt<"row justify-content-between bottom-information"ip><"clear">'
            });
            // var myTable = $('.dt-responsive ').DataTable();
        });</script>
    <script>
        function openSecondModal() {
            // Hide the first modal when it's hidden
            $('#raiseTicketModal').on('hidden.bs.modal', function (e) {
                // Open the second modal
                $('#secondModal').modal('show');

                // Unbind the event handler to prevent unwanted side effects
                $(this).off('hidden.bs.modal');
            });

            // Close the first modal
            $('#raiseTicketModal').modal('hide');
        }
    </script>

    <script>
        document.getElementById('paymentMethod').addEventListener('change', function () {
            var totalAmount = document.getElementById("amount").value;
            var bankDetailsDiv = document.getElementById('bankDetails');
            var phonepayDiv = document.getElementById('phonepayDetails');
            var qrCodeDiv = document.getElementById('qrCodeDetails');
            var paytmDiv = document.getElementById('usdtBep');
            var googlepayDiv = document.getElementById('usdtTrc');
            var usdtDiv = document.getElementById('usdtBnb');

            bankDetailsDiv.style.display = 'none';
            phonepayDiv.style.display = 'none';
            qrCodeDiv.style.display = 'none';
            paytmDiv.style.display = 'none';
            googlepayDiv.style.display = 'none';
            usdtDiv.style.display = 'none';

            switch (this.value) {
                case 'IMPS/NEFT':
                    bankDetailsDiv.style.display = 'block';
                    break;
                case 'UPI':
                    phonepayDiv.style.display = 'block';
                    var UPILink = document.getElementById("UPILink");
                    var UPIUrl = "phonepe://pay?pa=ambitionyes@ibl&cu=INR&am=" + totalAmount;
                    UPILink.setAttribute("href", UPIUrl);
                    break;
                case 'QR Code':
                    qrCodeDiv.style.display = 'block';
                    // Call generateQRCode function when QR Code option is selected
                    generateQRCode();
                    break;
                case 'USDT (BEP20)':
                    googlepayDiv.style.display = 'block';
                    break;
                case 'USDT (TRC20)':
                    paytmDiv.style.display = 'block';
                    break;
                case 'USDT (BNB)':
                    usdtDiv.style.display = 'block';
                    break;
                // Add cases for other payment methods as needed
            }
        });

        function generateQRCode() {
            var amount = document.getElementById("amount").value;
            document.getElementById("totalAmount").innerText = amount;
            var upiLink = document.getElementById("UPILink");
            var paytmUrl = "phonepe://pay?pa=ambitionyes@ibl&am=" + amount;
            upiLink.setAttribute("href", paytmUrl);
            fetch('/generateQRCode', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ amount: amount })
            })
                .then(response => response.text())
                .then(data => {
                    // Display the QR code image

                    console.log(data);
                    document.getElementById("qrCodeContainer").innerHTML = '<img src="data:image/png;base64,' + data + '" alt="QR Code">';
                })
                .catch(error => console.error('Error:', error));
        }
    </script>




    <script>
        document.addEventListener('DOMContentLoaded', function () {
            var amountInput = document.getElementById('amount');
            var buttons = document
                .querySelectorAll('#add-credits-buttons button');
            var paymentMethodSelect = document.getElementById('paymentMethod');

            buttons.forEach(function (button) {
                button.addEventListener('click', function () {
                    var price = parseInt(this.getAttribute('data-price'))
                        .toFixed(0);
                    amountInput.value = price;
                    paymentMethodSelect.removeAttribute('disabled');
                });
            });
        });
    </script>

    <script>
        function submitOrder() {
            var amountInput = document.getElementById('amount');
            var paymentMethod = document.getElementById('paymentMethod');
            var amountValue = amountInput.value.trim();
            var methodInput = document.getElementById('paymentMethod');
            var methodValue = methodInput.value.trim();
            if (amountValue !== "" && methodValue !== "") {
                openSecondModal();
            } else {
                alert("Please Select to Proceed");
            }
        }

        // for hamburger 
        const mobileScreen = window.matchMedia("(max-width: 990px )");
        $(document).ready(function () {
            $(".dashboard-nav-dropdown-toggle").click(function () {
                $(this).closest(".dashboard-nav-dropdown")
                    .toggleClass("show")
                    .find(".dashboard-nav-dropdown")
                    .removeClass("show");
                $(this).parent()
                    .siblings()
                    .removeClass("show");
            });
            $(".menu-toggle").click(function () {
                if (mobileScreen.matches) {
                    $(".dashboard-nav").toggleClass("mobile-show");
                } else {
                    $(".dashboard").toggleClass("dashboard-compact");
                }
            });
        });
    </script>

</body>

</html>